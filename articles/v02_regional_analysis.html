<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Regional analysis with tidycensuskr • tidycensuskr.sf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Regional analysis with tidycensuskr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidycensuskr.sf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v02_regional_analysis.html">Regional analysis with tidycensuskr</a></li>
    <li><a class="dropdown-item" href="../articles/v03_gallery.html">Analytics Gallery with tidycensuskr</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sigmafelix/tidycensuskr.sf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Regional analysis with tidycensuskr</h1>
            
            <h4 data-toc-skip class="date">November 23, 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sigmafelix/tidycensuskr.sf/blob/main/vignettes/v02_regional_analysis.Rmd" class="external-link"><code>vignettes/v02_regional_analysis.Rmd</code></a></small>
      <div class="d-none name"><code>v02_regional_analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="example-1-population-change-in-the-gyeongsangnam-do-region">Example 1: Population change in the Gyeongsangnam-do region<a class="anchor" aria-label="anchor" href="#example-1-population-change-in-the-gyeongsangnam-do-region"></a>
</h2>
<div class="section level3">
<h3 id="design-idea">Design idea<a class="anchor" aria-label="anchor" href="#design-idea"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Load 2010 and 2020 census population data.</li>
<li>Merge with 2020 district boundaries.</li>
<li>Calculate the population change
(<code>change = 2020 − 2010</code>).</li>
<li>Subset to Gyeongsangnam-do, Busan, and Ulsan.</li>
<li>Create a diverging choropleth map to show population
increase/decrease, with an inset map of Korea highlighting the
region.</li>
</ol>
</div>
<div class="section level3">
<h3 id="data-prep">Data prep<a class="anchor" aria-label="anchor" href="#data-prep"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load 2020 boundaries</span></span>
<span><span class="va">sf_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sigmafelix.github.io/tidycensuskr/reference/load_districts.html" class="external-link">load_districts</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load census population data for 2010 and 2020</span></span>
<span><span class="va">df_2010_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sigmafelix.github.io/tidycensuskr/reference/anycensus.html" class="external-link">anycensus</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2010</span>,</span>
<span>                         codes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gyeongsangnam-do"</span>, <span class="st">"Busan"</span>, <span class="st">"Ulsan"</span><span class="op">)</span>, </span>
<span>                         type <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span></span>
<span><span class="va">df_2020_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sigmafelix.github.io/tidycensuskr/reference/anycensus.html" class="external-link">anycensus</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>                         codes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gyeongsangnam-do"</span>, <span class="st">"Busan"</span>, <span class="st">"Ulsan"</span><span class="op">)</span>, </span>
<span>                         type <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge with spatial data and compute population change</span></span>
<span><span class="va">sf_target</span> <span class="op">&lt;-</span> <span class="va">sf_2020</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">df_2010_pop</span>, by <span class="op">=</span> <span class="st">"adm2_code"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">df_2020_pop</span>, by <span class="op">=</span> <span class="st">"adm2_code"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>change <span class="op">=</span> <span class="va">`all households_total_prs.y`</span> <span class="op">-</span> <span class="va">`all households_total_prs.x`</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-choropleth-map-with-an-inset-map">A choropleth map with an inset map<a class="anchor" aria-label="anchor" href="#a-choropleth-map-with-an-inset-map"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Choropleth map for population change</span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">sf_target</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">change</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray80"</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Population change between 2010 and 2020"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradient2</span><span class="op">(</span></span>
<span>    low <span class="op">=</span> <span class="st">"#2C7BB6"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"#D7191C"</span>,</span>
<span>    midpoint <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Change"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_scale</span><span class="op">(</span>location <span class="op">=</span> <span class="st">"tr"</span>, width_hint <span class="op">=</span> <span class="fl">0.25</span>, text_cex <span class="op">=</span> <span class="fl">0.7</span>, line_width <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># National boundary (union of all districts)</span></span>
<span><span class="va">sf_korea_boundary</span> <span class="op">&lt;-</span> <span class="va">sf_2020</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Target region boundary (union of selected provinces/cities)</span></span>
<span><span class="va">sf_target_boundary</span> <span class="op">&lt;-</span> <span class="va">sf_target</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inset map: whole Korea + highlighted target region</span></span>
<span><span class="va">korea_inset</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sf_korea_boundary</span>, fill <span class="op">=</span> <span class="st">"grey90"</span>, color <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sf_target_boundary</span>, fill <span class="op">=</span> <span class="st">"grey30"</span>, color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine main map and inset</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html" class="external-link">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html" class="external-link">draw_plot</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html" class="external-link">draw_plot</a></span><span class="op">(</span><span class="va">korea_inset</span>, x <span class="op">=</span> <span class="fl">0.7</span>, y <span class="op">=</span> <span class="fl">0.05</span>, width <span class="op">=</span> <span class="fl">0.25</span>, height <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">draw_grob</span><span class="op">(</span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.rect.html" class="external-link">rectGrob</a></span><span class="op">(</span>gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span>, lwd <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            x <span class="op">=</span> <span class="fl">0.7</span>, y <span class="op">=</span> <span class="fl">0.05</span>, width <span class="op">=</span> <span class="fl">0.25</span>, height <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span></code></pre></div>
<p><img src="v02_regional_analysis_files/figure-html/choropleth_1-1.png" class="r-plt" width="672">
In the Gyeongsangnam-do region, large metropolitan cities such as Busan
and Ulsan show population decline, while surrounding suburban areas
demonstrate notable population gains. Rural areas in the western part of
the province exhibit relatively stable population trends.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-2-bivariate-mapping-of-population-vs--tax">Example 2: Bivariate mapping of population vs. tax<a class="anchor" aria-label="anchor" href="#example-2-bivariate-mapping-of-population-vs--tax"></a>
</h2>
<div class="section level3">
<h3 id="design-idea-1">Design idea<a class="anchor" aria-label="anchor" href="#design-idea-1"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Load 2020 population and tax datasets.</li>
<li>Because tax data is not available at the <em>Gu</em> level of large
cities, aggregate district-level (<code>adm2_code</code>) data to the
4-digit prefix level.</li>
<li>Merge population and tax data.</li>
<li>Use <code><a href="https://chris-prener.github.io/biscale/reference/bi_class.html" class="external-link">biscale::bi_class()</a></code> to create a 3×3 bivariate
classification of population (x) vs. tax (y).</li>
<li>Draw a bivariate choropleth map with a custom legend.</li>
</ol>
</div>
<div class="section level3">
<h3 id="data-prep-1">Data prep<a class="anchor" aria-label="anchor" href="#data-prep-1"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load 2020 boundaries</span></span>
<span><span class="va">sf_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sigmafelix.github.io/tidycensuskr/reference/load_districts.html" class="external-link">load_districts</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load census data</span></span>
<span><span class="va">df_2020_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sigmafelix.github.io/tidycensuskr/reference/anycensus.html" class="external-link">anycensus</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>                         type <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span></span>
<span><span class="va">df_2020_tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sigmafelix.github.io/tidycensuskr/reference/anycensus.html" class="external-link">anycensus</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>                         type <span class="op">=</span> <span class="st">"tax"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge population with boundaries</span></span>
<span><span class="va">sf_2020_pop</span> <span class="op">&lt;-</span> <span class="va">sf_2020</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">df_2020_pop</span>, by <span class="op">=</span> <span class="st">"adm2_code"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    adm2_code_chr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">adm2_code</span><span class="op">)</span>,</span>
<span>    adm2_prefix4  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">adm2_code_chr</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    last_digit    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">adm2_code_chr</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Aggregate smaller units (adm2_code ending not with 0) into 4-digit groups</span></span>
<span><span class="va">sf_union_needed</span> <span class="op">&lt;-</span> <span class="va">sf_2020_pop</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">last_digit</span> <span class="op">!=</span> <span class="st">"0"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">adm2_prefix4</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    <span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>adm2_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">adm2_prefix4</span>, <span class="st">"0"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine aggregated units with existing "0"-ending districts</span></span>
<span><span class="va">sf_2020_unioned</span> <span class="op">&lt;-</span> <span class="va">sf_2020_pop</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">last_digit</span> <span class="op">==</span> <span class="st">"0"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">sf_union_needed</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join with tax data</span></span>
<span><span class="va">sf_final</span> <span class="op">&lt;-</span> <span class="va">sf_2020_unioned</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">df_2020_tax</span>, by <span class="op">=</span> <span class="st">"adm2_code"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-bivariate-choropleth-map">A bivariate choropleth map<a class="anchor" aria-label="anchor" href="#a-bivariate-choropleth-map"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create 3x3 bivariate classes (population vs tax)</span></span>
<span><span class="va">bi_data</span> <span class="op">&lt;-</span> <span class="fu">bi_class</span><span class="op">(</span></span>
<span>  <span class="va">sf_final</span>,</span>
<span>  x <span class="op">=</span> <span class="va">`all households_total_prs`</span>,</span>
<span>  y <span class="op">=</span> <span class="va">income_general_mkr</span>,</span>
<span>  style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>  dim <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bivariate legend</span></span>
<span><span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu">bi_legend</span><span class="op">(</span></span>
<span>  pal <span class="op">=</span> <span class="st">"DkCyan"</span>, dim <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Low to High population"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Low to High tax"</span>,</span>
<span>  size <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mapping</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html" class="external-link">ggdraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html" class="external-link">draw_plot</a></span><span class="op">(</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">bi_data</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">bi_class</span><span class="op">)</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">bi_scale_fill</span><span class="op">(</span>pal <span class="op">=</span> <span class="st">"DkCyan"</span>, dim <span class="op">=</span> <span class="fl">3</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">bi_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Population vs Tax (2020)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html" class="external-link">draw_plot</a></span><span class="op">(</span><span class="va">legend</span>, x <span class="op">=</span> <span class="fl">0.7</span>, y <span class="op">=</span> <span class="fl">0.1</span>, width <span class="op">=</span> <span class="fl">0.3</span>, height <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="v02_regional_analysis_files/figure-html/bivariate_2-1.png" class="r-plt" width="672"></p>
<p>The bivariate map highlights the strong centrality of the Seoul
Metropolitan Area. Both the capital region and the southeastern
manufacturing hubs exhibit high population and high tax revenues. In
contrast, most other regions—such as Gangwon and Gyeongbuk, apart from a
few metropolitan centers—fall into the low population–low tax
category.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-3-sex-ratio-in-seoul-metropolitan-area">Example 3: Sex ratio in Seoul Metropolitan Area<a class="anchor" aria-label="anchor" href="#example-3-sex-ratio-in-seoul-metropolitan-area"></a>
</h2>
<div class="section level3">
<h3 id="design-idea-2">Design idea<a class="anchor" aria-label="anchor" href="#design-idea-2"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Load 2020 population data for Seoul, Gyeonggi-do, and Incheon.</li>
<li>Calculate the sex ratio (<code>male/female × 100</code>).</li>
<li>Visualize the distribution of sex ratios:
<ul>
<li>Show the overall distribution as a grey background histogram.</li>
<li>Overlay regional distributions (Seoul, Incheon, Gyeonggi-do) in
color with facets.</li>
</ul>
</li>
<li>Map the sex ratio across districts, using a diverging color scale
centered on 100 (balanced sex ratio).</li>
</ol>
</div>
<div class="section level3">
<h3 id="data-prep-2">Data prep<a class="anchor" aria-label="anchor" href="#data-prep-2"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load population data for the Seoul Metropolitan Area (SMA)</span></span>
<span><span class="va">df_sma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sigmafelix.github.io/tidycensuskr/reference/anycensus.html" class="external-link">anycensus</a></span><span class="op">(</span></span>
<span>  year  <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  codes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Seoul"</span>, <span class="st">"Gyeonggi-do"</span>, <span class="st">"Incheon"</span><span class="op">)</span>,</span>
<span>  type  <span class="op">=</span> <span class="st">"population"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate sex ratio (males per 100 females)</span></span>
<span><span class="va">df_sma</span> <span class="op">&lt;-</span> <span class="va">df_sma</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sex_ratio <span class="op">=</span> <span class="va">`all households_male_prs`</span> <span class="op">/</span> <span class="va">`all households_female_prs`</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract overall distribution (all SMA combined)</span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span> <span class="va">df_sma</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">sex_ratio</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="histograms">Histograms<a class="anchor" aria-label="anchor" href="#histograms"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Background: overall distribution across all SMA</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_all</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex_ratio</span>, y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">20</span>, fill <span class="op">=</span> <span class="st">"grey80"</span>, color <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Regional distributions</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_sma</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex_ratio</span>, y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">adm1</span><span class="op">)</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">20</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, color <span class="op">=</span> <span class="cn">NA</span>, position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">adm1</span>, ncol <span class="op">=</span> <span class="fl">3</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Seoul"</span> <span class="op">=</span> <span class="st">"darkorange"</span>,</span>
<span>    <span class="st">"Incheon"</span> <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>    <span class="st">"Gyeonggi-do"</span> <span class="op">=</span> <span class="st">"cyan4"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Sex ratio distribution by region (SMA, 2020)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Sex ratio (male per 100 females)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="v02_regional_analysis_files/figure-html/histogram_3-1.png" class="r-plt" width="672"></p>
</div>
<div class="section level3">
<h3 id="a-choropleth-map">A choropleth map<a class="anchor" aria-label="anchor" href="#a-choropleth-map"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load boundaries</span></span>
<span><span class="va">sf_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sigmafelix.github.io/tidycensuskr/reference/load_districts.html" class="external-link">load_districts</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge SMA population data with boundaries</span></span>
<span><span class="va">sf_2020_sma</span> <span class="op">&lt;-</span> <span class="va">sf_2020</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">df_sma</span>, by <span class="op">=</span> <span class="st">"adm2_code"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Choropleth map for sex ratio</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">sf_2020_sma</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sex_ratio</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray"</span>, size <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradient2</span><span class="op">(</span></span>
<span>    low <span class="op">=</span> <span class="st">"#2C7BB6"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"#D7191C"</span>,</span>
<span>    midpoint <span class="op">=</span> <span class="fl">100</span>,                        <span class="co"># 100 = equal male/female</span></span>
<span>    name <span class="op">=</span> <span class="st">"Sex ratio\n(males per 100 females)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sex ratio in the Seoul Metropolitan Area (2020)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="v02_regional_analysis_files/figure-html/choropleth_3-1.png" class="r-plt" width="672"></p>
<p>Within the Seoul Metropolitan Area, the central city districts
(Seoul) show a higher proportion of females, whereas the outer suburban
areas tend to show male-dominated populations. This highlights spatial
differences in gender distribution across the metropolitan region.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Insang Song, Sohyun Park, Hyesop Shin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
